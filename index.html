<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src'self'; object-src 'none'; base-uri 'self'; form-action'none'">
  <title>PasswordForge</title>
  <link rel="icon" href="icoin1.png" sizes="100%">
  <!--
    Note: For production, serve with a strict Content-Security-Policy and over HTTPS.
    See README.md for suggested headers.
  -->

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main id="app" class="container">
    <h1 class="fancy-title">PasswordForge</h1>
    <header class="header">
        
      <div class="trust">
        <strong>لا نخزن كلمات المرور نصًا.</strong>
        <span>كل العمليات تتم client-side. نحفظ فقط hashes مشفَّرة محليًا (غير قابلة للاسترجاع افتراضيًا).</span>
        <button id="learnMoreBtn" class="small-btn" aria-label="Learn more about privacy">استكشاف كيف نقدم خدمتنا</button>
      </div>
      
      <p class="subtitle">مولّد كلمات مرور احترافي — خصوصية متقدّمة، توليد آمن باستخدام Web Crypto API</p>
    </header>

    <section class="controls">
      <div class="row">
        <label for="length">طول كلمة المرور: <span id="lengthVal">16</span></label>
        <input id="length" type="range" min="8" max="64" value="16" />
      </div>
<BR>
      <div class="row">
        <fieldset >
          <legend >الأحرف</legend>
          <label><input type="checkbox" id="includeUpper" checked />أحرف كبيرة</label>
          <label><input type="checkbox" id="includeLower" checked />أحرف صغيرة</label>
          <label><input type="checkbox" id="includeNumbers" checked />أرقام</label>
          <label><input type="checkbox" id="includeSymbols" />رموز</label>
        </fieldset>

        <fieldset >
          <legend >خيارات متقدمة</legend>
          <label>الوضع
            <select id="strengthMode" aria-label="Strength mode">
              <option value="balanced">متوازن</option>
              <option value="high">عالية الأمان</option>
              <option value="memorable">لا تنسى</option>
            </select>
          </label>

          <label>النمط
            <select id="pattern">
              <option value="random">عشوائي</option>
              <option value="readable">عبارة مرور قابلة للقراءة</option>
              <option value="hybrid">هجين</option>
            </select>
          </label>

          <label><input type="checkbox" id="forceFirstUpper" />فرض الأحرف الكبيرة الأولى</label>
          <label><input type="checkbox" id="excludeSimilar" />استبعاد الأحرف المتشابهة (0 O o 1 l I)</label>
          <label>استبعاد الأحرف:
            <input id="excludeChars" type="text" placeholder="-{}[]\"`\\;:,.<>/?" />
          </label>
        </fieldset>
      </div>
      <br>
      <div class="row presets">
        <label>الإعداد المسبق:
          <select id="preset">
            <option value="custom">مخصص</option>
            <option value="social">وسائل التواصل الاجتماعي</option>
            <option value="email">بريد إلكتروني</option>
            <option value="wifi">Wi-Fi</option>
            <option value="gaming">الألعاب</option>
          </select>
        </label>

        <label>عدد الدفعة:
          <input id="batchCount" type="number" min="1" max="50" value="1" />
        </label>
      </div>
<br><br>
      <div class="row actions">
        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
        <button id="generateBtn" class="primary">يولد</button>&nbsp; 
        <button id="regenerateBtn" class="secondary">تجديد</button>&nbsp; 
        <button id="copyBtn" class="secondary" aria-label="Copy password">ينسخ</button>&nbsp; 
        <button id="downloadCsvBtn" class="secondary">قم بتنزيل ملف CSV</button>&nbsp; 
        <button id="exportReportBtn" class="secondary"> قم بتنزيل ملف(PNG)</button>&nbsp; 
      </div>
    </section>

    <section class="result" aria-live="polite">
      <div class="result-card">
        <div class="pw-line">
          <button id="showHideBtn" aria-label="Show or hide password">يعرض</button>
          <code id="passwordDisplay" class="masked" aria-hidden="true">*</code>
        </div>

        <div class="metrics">
          <div>
            <label>قوة كلمة المرور:</label>
            <progress id="strengthBar" value="0" max="100"></progress>
            <span id="strengthText">0%</span>
          </div>
          <div>
            <label>مقدار عدم النظام:</label>
            <span id="entropyText">0 bits</span>
          </div>
          <div>
            <label>تقدير القوة :</label>
            <span id="bfText">—</span>
          </div>
        </div>

        <div class="explain">
          <details>
            <summary>معادلة التقييم المختصرة (اضغط للمشاهدة)</summary>
            <p id="entropyFormula">—</p>
            <p class="micro">افتراضات: معدل التجزئة = <span id="hashRate">100,000,000,000</span> guesses/sec </p>
          </details>
        </div>
      </div>
    </section>

    <footer>
      <small>PasswordForge — كل شيء يحدث محليًا. لا توجد اتصالات خارجية.</small>
    </footer>
  </main>

  <!-- Modal (privacy & security) -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content">
      <button id="modalClose" class="modal-close" aria-label="Close">✕</button>
      <h2 style="color:red">*شرح الخصوصية والأمن </h2>
      <section>
        <h3 style="color: yellow;">ما الذي يحدث محليًا</h3>
        <ul>
          <li>التوليد يتم باستخدام <code>crypto.getRandomValues</code> فقط.</li>
          <li>نحسب SHA-256 لكلمة المرور مع salt محلي عند كل توليد ونخزن الـhash فقط.</li>
          <li>إذا اخترت حفظ الهاش، يُخزّن مشفَّرًا (AES-GCM) في localStorage مع مفتاح مُخزّن محليًا.</li>
        </ul>
      </section>

      <section>
        <h3 style="color: yellow;">التخزين وقيود الأمان</h3>
        <p>localStorage وIndexedDB هما وسائط تخزين محلية؛ قد يصل إليها مستخدم يمتلك الوصول إلى الجهاز. لرفع مستوى الأمان، يُفضّل تخزين hashes على سيرفر مشفّر مُدار أو استخدام hardware-backed key stores.</p>
      </section>

      <section>
        <h3 style="color: yellow;">عدم الإرسال</h3>
        <p>لا يتم إرسال أي كلمات مرور أو telemetry إلى خوادم خارجية تلقائيًا. أي إرسال يجب أن يكون صريحًا وواضحًا.</p>
      </section>
    </div>
  </div>

  <script src="Script.js" defer></script>
  <!-- file: index.html (استبدل السكربت fetch الحالي بهذە القطعة) -->
<script>
  // لا ترسل أي شيء تلقائياً. استعمل دالة تُستدعى بعد موافقة صريحة.
  async function sendHashToServerIfOptIn(hash) {
    // تحقق من موافقة المستخدم صراحة (مثال: قيمة من الإعدادات)
    const consent = await storageManager.get('userConsentSendHashes'); // يجب أن تتّبع هذه القيمة في إعدادات UI
    if (!consent) {
      console.warn('User has not consented to send hashes to server.');
      return;
    }

    try {
      // إرسال فقط عبر HTTPS و endpoint معتمد
      const resp = await fetch("https://api.example.com/hash", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ hash })
      });
      if (!resp.ok) throw new Error(`Server error ${resp.status}`);
      return await resp.json();
    } catch (err) {
      console.error('Failed to send hash:', err);
    }
  }

  // مثال استدعاء (يجب أن يُفعل فقط بعد موافقة المستخدم صريحة في UI)
  // sendHashToServerIfOptIn('abcdef...');
</script>

</body>
</html>

